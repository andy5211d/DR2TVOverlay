# Description
DR2TVOverlay is an Extension for OBS Studio built on top of its scripting facilities utilising built-in embedded LuaJIT interpreter.
This Lua script uses a number of OBS-Studio Sources to display the event information from DiveRecorder (DR) onto
the event video stream (https://www.diverecorder.co.uk).  To use this script the user will need to be reasonably familiar
with Diverecorder and OBS-Studio.  Use the latest version, others kept for my reference during ongoing development.

The script uses the data provided by DR's DR2Video software and its associated text files.  Once running the script
automatically checks the DR2Video files and if a change is detected displays the new information.  The user has the 
capability to automatically hide the dive information overlay and re-display it when DR has updated the file and changes
detected by OBS.  Works for both Individual events and Synchro events and a variable number of judges.  The script works 
with simultaneous events (A & B) as DR2Video has this capability however the user must select which event the overlay is for.
The script does NOT work for a skills circuit!

The information overlay needs to use a Mono type font (I use DejaVu Sans Mono Book) which needs to be loaded on the PC, else
the awards alignment will be wrong and some data may be outside the video overlay area.  This script will not function 
correctly without the OBS Source's generated by the JSON file which needs to be imported into OBS by the user.  All the
set-up information is retained by OBS for future runs and does not need to be re-entered.

Diverecorders DR2Video software has a number of user configurable fields where the relevant computer files will be located. 
These file locations need to be entered into the DR2TVOverlay script fields.  An example file location is shown by the script
but this will not work without modification by the user for their specific computer user-id (you can edit the Lua script with
you User-ID if you wish).

There are two different overlay layouts provided by the two script major versions, however at present only script V2.n.n has
the necessary JSON source file available in this repository.  It is unlikely that the V1.n.n script and associated layout 
will be developed further.  

Most user functions (V2.1.0 onwards) can be controlled by hotkeys, as follows:

    F1 = Temporary remove overlays (until next DR2Video file update)

    F2 = Temporary show overlays (until next DR2Video file update)

    F3 = Disable overlay updates (freeze the display)

    F5 = Permanently remove all overlays

    F8 = Disable auto-hide of overlays

    F9 = Toggle event type, Individual or Synchro

    F10 = Toggle to display Event A or Event B

    F11 = OBS full screen mode (a predefined OBS hotkey)
    
    F12 = Toggle Event overlay position, top left or top right

# Installation 
- Download and install Exeldro's 'Source Dock', 'Gradient Source' and optionally from Palakis 'obs-websocket'.

- Download zip file from (https://github.com//andy5211d/DR2TVOverlay), unpack/unzip.

    Add `divingoverlaysV2.x.x.lua` to OBS Studio via Tools>Scripts > "+" button. 

    Import 'divingoverlays-obssource.json' to OBS Studio via Profile>Import and select the .json file

On first install the user must map the necessary DR2Video files in OBS as can be seen in the following two screenshots.

The file location mapping in DR2Video:
![gif](https://github.com/andy5211d/DR2TVOverlay/blob/main/gifs/DR2Videofilelocations.gif)

The file location mapping in OBS-Studio DR2TVOverlay script:
![gif](https://github.com/andy5211d/DR2TVOverlay/blob/main/gifs/OBSscriptfilelocations.gif)

The above are two file mapping examples, you can use any mapping that make sense to Windows, but ensure that they are
consistant!  Errors in file mapping are the usual cause of the script not working.  It will be necessary to run an
event or two in Diverecorder to generate the files in DR2Video so as to be able to map them. One event will need to be Event B
to produce the required files.  This file mapping should only need to be done once, on initial installation of the script. 

# Usage
These operating instructions assume that the user is familiar with Diverecorder and OBS-Studio.  Both programs have lots of
on-line resources on set-up and operation which will not be repeated here.  Diverecorder's DR2Video needs to be loaded and
the scoreboard enabled before OBS-Studio will function correctly (as well of course Diverecorder running an event!).  It is
not important the exact load sequence but I tend to run DR2Video before OBS-Studio.

The default start-up of the script has the following settings:
- Individual Event (F9)
- Event A (F10)
- Event Overlay top left (F12)
- Auto-hide of overlay enabled (F8)
- Overlay Update enabled (F3)
- Overlays Visible (F5)

    if the initialisation has gone correctly then the Hotkey status dock will look something like this:
![gif](https://github.com/andy5211d/DR2TVOverlay/blob/main/gifs/hotkeystatusdock.gif)

It is likely on initial start-up that there will be the Event overlay showing with data from the last event.  This overlay
can be removed using either Hotkey F1 or F5 dependent upon user preference.  

The overlay script will generally follow what the event Recorders are doing in Diverecorder.  One running there should be
little to do but note, DR2TVOverlay does not have anyway of showing the reason for deductions, thus interventation in the
overlay may be desirable at times (use F3 F5 as necessary).

If 'obs-websocket' has been installed then it is possable to remotely control OBS using an iPhone or other portable device, 
the functions available remotely depent upon the app loaded on the portable device.  I'm still experementing with this 
capability!  